export SBC=/work/n01/n01/valegu/EA_R12_BIO/nemo_vr4.06/cfgs/ORCA2_MEDUSA/EXP_FINAL/ERA5/ 
cd $SBC

#The ERA5 fields have been downloaded in livljobs
ln -s $DOMAIN/coordinates.nc $SBC/.


# Ensure the correct modules are loaded for ARCHER2
# Load modules listed in /work/n01/shared/nemo/setup
# Tested 14Jan22
module swap craype-network-ofi craype-network-ucx
module swap cray-mpich cray-mpich-ucx
module load cray-hdf5-parallel/1.12.0.7
module load cray-netcdf-hdf5parallel/4.7.4.7

#Get the namelists and modify them to reflect your paths,names etc. I took the namelists from Anna's Github : 
#https://github.com/NOC-MSM/SEAsia_ERSEM_R12/tree/master/FILES_START/ATMOS_FORCING/namelist_reshape_bilin_atmos
#https://github.com/NOC-MSM/SEAsia_ERSEM_R12/tree/master/FILES_START/ATMOS_FORCING/namelist_reshape_bicubic_atmos

#Generate the weights for the atmospheric forcing (this requires that you have compiled successfully the NEMO-TOOLS in previous step):

$TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_atmos
$TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_atmos
$TDIR/WEIGHTS/scripshape.exe namelist_reshape_bilin_atmos
$TDIR/WEIGHTS/scrip.exe namelist_reshape_bicubic_atmos
$TDIR/WEIGHTS/scripshape.exe namelist_reshape_bicubic_atmos

#changes in the namelists manually if you have too
#sed -i 's,ERA5_MSL_y2017.nc,/work/n01/n01/annkat/SEAsia_ERSEM_CMEMS/SURFACE_FORCING/ERA5_MSDWLWRF_y2017.nc,g' namelist_reshape_bilin_atmos
#sed -i 's,/work/n01/n01/acc/DFS/DFS5.2/1960/drowned_precip_DFS5.2_y1960.nc,/work/n01/n01/annkat/SEAsia_ERSEM_CMEMS/SURFACE_FORCING/ERA5_MSDWLWRF_y2017.nc,g' namelist_reshape_bicubic_atmos

#generate weights
$TDIR/WEIGHTS/scripgrid.exe namelist_reshape_bilin_atmos
$TDIR/WEIGHTS/scrip.exe namelist_reshape_bilin_atmos
$TDIR/WEIGHTS/scripshape.exe namelist_reshape_bilin_atmos
$TDIR/WEIGHTS/scrip.exe namelist_reshape_bicubic_atmos
$TDIR/WEIGHTS/scripshape.exe namelist_reshape_bicubic_atmos

cd $WORK